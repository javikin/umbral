---
name: FirstProfilePromptCard en HomeScreen
status: closed
created: 2026-01-06T17:01:04Z
updated: 2026-01-06T17:04:35Z
github: https://github.com/javikin/umbral/issues/51
depends_on: [50]
parallel: false
conflicts_with: [49]
---

# Task: FirstProfilePromptCard en HomeScreen

## Description

Después de completar el onboarding simplificado (sin selección de apps), el usuario llega a Home sin perfiles. Necesitamos mostrar un card prominente que lo invite a crear su primer perfil de bloqueo.

Este card debe:
- Ser visualmente destacado (card grande)
- Aparecer solo si no hay perfiles creados
- Desaparecer automáticamente después de crear el primer perfil
- Navegar al flujo de creación de perfil al hacer click

## Acceptance Criteria

- [ ] Card prominente visible cuando `profiles.isEmpty()`
- [ ] Card NO visible cuando hay al menos un perfil
- [ ] Click en "Crear perfil" navega a ProfileDetailScreen (o similar)
- [ ] Card desaparece inmediatamente después de crear perfil
- [ ] Diseño consistente con el resto de la app (Material 3)
- [ ] Animación de entrada como los demás cards

## Technical Details

### 1. Modificar `HomeUiState` (en HomeViewModel.kt)

```kotlin
data class HomeUiState(
    val isLoading: Boolean = true,
    val isBlockingEnabled: Boolean = false,
    val activeProfile: BlockingProfile? = null,
    val currentStreak: Int = 0,
    val weeklyStats: List<Float> = emptyList(),
    val hasStatsData: Boolean = false,
    val hasProfiles: Boolean = false  // NUEVO
)
```

### 2. Modificar `HomeViewModel.kt`

```kotlin
init {
    loadHomeData()
    observeProfiles()  // NUEVO
}

private fun observeProfiles() {
    viewModelScope.launch {
        profileRepository.getAllProfiles().collect { profiles ->
            _uiState.update { it.copy(hasProfiles = profiles.isNotEmpty()) }
        }
    }
}
```

### 3. Crear componente `FirstProfilePromptCard` (en HomeScreen.kt)

```kotlin
@Composable
private fun FirstProfilePromptCard(
    onCreateProfile: () -> Unit,
    modifier: Modifier = Modifier
) {
    UmbralCard(
        modifier = modifier.fillMaxWidth(),
        elevation = UmbralElevation.Medium,
        onClick = onCreateProfile
    ) {
        Column(
            modifier = Modifier
                .fillMaxWidth()
                .padding(UmbralSpacing.lg),
            horizontalAlignment = Alignment.CenterHorizontally
        ) {
            Box(
                modifier = Modifier
                    .size(64.dp)
                    .clip(CircleShape)
                    .background(MaterialTheme.colorScheme.primaryContainer),
                contentAlignment = Alignment.Center
            ) {
                Icon(
                    imageVector = Icons.Default.Add,
                    contentDescription = null,
                    modifier = Modifier.size(32.dp),
                    tint = MaterialTheme.colorScheme.primary
                )
            }

            Spacer(modifier = Modifier.height(UmbralSpacing.md))

            Text(
                text = "Crea tu primer perfil",
                style = MaterialTheme.typography.titleLarge,
                fontWeight = FontWeight.Bold,
                color = MaterialTheme.colorScheme.onSurface
            )

            Spacer(modifier = Modifier.height(UmbralSpacing.sm))

            Text(
                text = "Define qué apps bloquear y cómo desbloquearlas con NFC o timer",
                style = MaterialTheme.typography.bodyMedium,
                textAlign = TextAlign.Center,
                color = MaterialTheme.colorScheme.onSurfaceVariant
            )

            Spacer(modifier = Modifier.height(UmbralSpacing.lg))

            Button(
                onClick = onCreateProfile,
                modifier = Modifier.fillMaxWidth()
            ) {
                Icon(
                    imageVector = Icons.Default.Add,
                    contentDescription = null,
                    modifier = Modifier.size(18.dp)
                )
                Spacer(modifier = Modifier.width(8.dp))
                Text("Crear perfil")
            }
        }
    }
}
```

### 4. Integrar en `HomeScreenContent`

```kotlin
@Composable
private fun HomeScreenContent(
    uiState: HomeUiState,
    onToggleBlocking: () -> Unit,
    onNfcScanClick: () -> Unit,
    onQrScanClick: () -> Unit,
    onStatsClick: () -> Unit,
    onCreateProfile: () -> Unit,  // NUEVO parámetro
    modifier: Modifier = Modifier
) {
    // ... animation states existentes
    var showFirstProfileCard by remember { mutableStateOf(false) }

    LaunchedEffect(Unit) {
        delay(100)
        showStatusCard = true
        // Si no hay perfiles, mostrar el prompt
        if (!uiState.hasProfiles) {
            delay(150)
            showFirstProfileCard = true
        }
        delay(150)
        showStreakCard = true
        // ... resto igual
    }

    Column(...) {
        // Status Card (existente)
        AnimatedVisibility(visible = showStatusCard, ...) {
            StatusCard(...)
        }

        Spacer(modifier = Modifier.height(UmbralSpacing.lg))

        // NUEVO: First Profile Prompt (solo si no hay perfiles)
        AnimatedVisibility(
            visible = showFirstProfileCard && !uiState.hasProfiles,
            enter = fadeIn(animationSpec = tween(400)) +
                    slideInVertically(
                        animationSpec = spring(
                            dampingRatio = Spring.DampingRatioMediumBouncy,
                            stiffness = Spring.StiffnessLow
                        ),
                        initialOffsetY = { 50 }
                    )
        ) {
            FirstProfilePromptCard(
                onCreateProfile = onCreateProfile,
                modifier = Modifier.fillMaxWidth()
            )
        }

        // Streak Card (solo si hay perfiles o para mostrar progreso)
        if (uiState.hasProfiles) {
            Spacer(modifier = Modifier.height(UmbralSpacing.lg))
            AnimatedVisibility(visible = showStreakCard, ...) {
                StreakCard(currentStreak = uiState.currentStreak)
            }
        }

        // ... resto de cards
    }
}
```

### 5. Agregar navegación en `HomeScreen`

```kotlin
@Composable
fun HomeScreen(
    onNavigateToNfcScan: () -> Unit = {},
    onNavigateToQrScan: () -> Unit = {},
    onNavigateToStats: () -> Unit = {},
    onNavigateToCreateProfile: () -> Unit = {},  // NUEVO
    modifier: Modifier = Modifier,
    viewModel: HomeViewModel = hiltViewModel()
) {
    val uiState by viewModel.uiState.collectAsState()

    HomeScreenContent(
        uiState = uiState,
        onToggleBlocking = viewModel::toggleBlocking,
        onNfcScanClick = onNavigateToNfcScan,
        onQrScanClick = onNavigateToQrScan,
        onStatsClick = onNavigateToStats,
        onCreateProfile = onNavigateToCreateProfile,  // NUEVO
        modifier = modifier
    )
}
```

### 6. Actualizar navegación principal

En el NavHost principal, asegurar que `onNavigateToCreateProfile` navegue correctamente.

## Dependencies

- [ ] Task 003 (Simplificar onboarding) - Para que el flujo sea coherente
- [ ] `ProfileRepository.getAllProfiles()` debe existir
- [ ] Navegación a crear perfil debe estar configurada

## Effort Estimate

- Size: M
- Hours: 1
- Parallel: false (depende de 003, conflicts con 002)

## Definition of Done

- [ ] Card visible para usuarios sin perfiles
- [ ] Card desaparece al crear perfil
- [ ] Navegación a crear perfil funciona
- [ ] Animaciones consistentes
- [ ] Probado en dispositivo real (fresh install)
