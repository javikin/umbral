---
name: widget-streak
status: closed
priority: high
github: https://github.com/javikin/umbral/issues/42
created: 2026-01-06T02:54:04Z
updated: 2026-01-06T04:03:42Z
depends_on: [40]
parallel: true
---

# Task 3: Widget de Streak

## Objetivo

Crear widget que muestre la racha de días consecutivos y mini calendario semanal.

## Implementación

### 1. Crear streak_widget_info.xml

```xml
<!-- res/xml/streak_widget_info.xml -->
<?xml version="1.0" encoding="utf-8"?>
<appwidget-provider xmlns:android="http://schemas.android.com/apk/res/android"
    android:minWidth="110dp"
    android:minHeight="110dp"
    android:targetCellWidth="2"
    android:targetCellHeight="2"
    android:resizeMode="none"
    android:widgetCategory="home_screen"
    android:initialLayout="@layout/widget_streak_loading"
    android:previewImage="@drawable/widget_streak_preview"
    android:description="@string/widget_streak_description"
    android:updatePeriodMillis="86400000" />
```

### 2. Crear StreakWidget.kt

```kotlin
package com.umbral.glance

import androidx.compose.runtime.Composable
import androidx.glance.*
import androidx.glance.appwidget.*
import androidx.glance.layout.*
import androidx.glance.text.Text
import java.time.DayOfWeek
import java.time.LocalDate

class StreakWidget : GlanceAppWidget() {

    @Composable
    override fun Content() {
        val streakDays = // Obtener de StreakRepository
        val weekActivity = // Obtener actividad de la semana

        GlanceTheme {
            StreakWidgetContent(streakDays, weekActivity)
        }
    }
}

@Composable
private fun StreakWidgetContent(
    streakDays: Int,
    weekActivity: List<Boolean> // L, M, X, J, V, S, D
) {
    Column(
        modifier = GlanceModifier
            .fillMaxSize()
            .background(WidgetColors.surface)
            .cornerRadius(16.dp)
            .clickable(actionStartActivity<MainActivity>())
            .padding(16.dp),
        horizontalAlignment = Alignment.CenterHorizontally
    ) {
        // Streak number with fire icon
        Row(
            verticalAlignment = Alignment.CenterVertically
        ) {
            Image(
                provider = ImageProvider(R.drawable.ic_fire),
                contentDescription = null,
                modifier = GlanceModifier.size(32.dp),
                colorFilter = ColorFilter.tint(WidgetColors.streak)
            )
            Spacer(modifier = GlanceModifier.width(4.dp))
            Text(
                text = streakDays.toString(),
                style = TextStyle(
                    color = WidgetColors.onSurface,
                    fontSize = 32.sp,
                    fontWeight = FontWeight.Bold
                )
            )
        }

        Text(
            text = "días",
            style = TextStyle(color = WidgetColors.onSurfaceVariant)
        )

        Spacer(modifier = GlanceModifier.height(12.dp))

        // Week calendar
        Row(
            modifier = GlanceModifier.fillMaxWidth(),
            horizontalAlignment = Alignment.CenterHorizontally
        ) {
            val dayLabels = listOf("L", "M", "X", "J", "V", "S", "D")
            val today = LocalDate.now().dayOfWeek.value - 1 // 0-indexed

            dayLabels.forEachIndexed { index, label ->
                Column(
                    horizontalAlignment = Alignment.CenterHorizontally,
                    modifier = GlanceModifier.padding(horizontal = 4.dp)
                ) {
                    Text(
                        text = label,
                        style = TextStyle(
                            color = if (index == today)
                                WidgetColors.primary
                            else
                                WidgetColors.onSurfaceVariant,
                            fontSize = 10.sp
                        )
                    )
                    Spacer(modifier = GlanceModifier.height(4.dp))
                    Box(
                        modifier = GlanceModifier
                            .size(16.dp)
                            .cornerRadius(8.dp)
                            .background(
                                if (weekActivity.getOrElse(index) { false })
                                    WidgetColors.primary
                                else
                                    ColorProvider(Color(0xFF374151))
                            )
                    )
                }
            }
        }
    }
}
```

### 3. Crear StreakWidgetReceiver.kt

```kotlin
package com.umbral.glance

import androidx.glance.appwidget.GlanceAppWidget
import androidx.glance.appwidget.GlanceAppWidgetReceiver

class StreakWidgetReceiver : GlanceAppWidgetReceiver() {
    override val glanceAppWidget: GlanceAppWidget = StreakWidget()
}
```

### 4. Registrar en AndroidManifest.xml

```xml
<receiver
    android:name=".glance.StreakWidgetReceiver"
    android:exported="true">
    <intent-filter>
        <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
    </intent-filter>
    <meta-data
        android:name="android.appwidget.provider"
        android:resource="@xml/streak_widget_info" />
</receiver>
```

### 5. Agregar Strings e Iconos

```xml
<string name="widget_streak_description">Muestra tu racha de días usando Umbral</string>
```

Crear `ic_fire.xml` en drawable (vector de fuego).

## Criterio de Done

- [ ] Widget aparece en picker de Android
- [ ] Muestra número correcto de días de streak
- [ ] Mini calendario muestra días activos de la semana
- [ ] Día actual está destacado
- [ ] Tap abre pantalla de estadísticas
- [ ] Se actualiza diariamente

## Estimación

~4 horas
