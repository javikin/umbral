---
name: Timer en pantalla de bloqueo + Resumen al finalizar sesión
status: closed
created: 2026-01-16T04:06:48Z
updated: 2026-01-16T15:27:04Z
github: https://github.com/javikin/umbral/issues/77
depends_on: [76]
parallel: false
conflicts_with: []
---

# Task: Timer en pantalla de bloqueo + Resumen al finalizar sesión

## Description

Mejorar la experiencia de usuario mostrando:
1. **Tiempo transcurrido** en la pantalla de bloqueo (mientras está activa)
2. **Resumen de sesión** al finalizar el bloqueo

## Acceptance Criteria

### Parte 1: Timer en Pantalla de Bloqueo
- [x] Mostrar tiempo transcurrido desde inicio de sesión (formato: "Llevas X min enfocado")
- [x] Actualizar cada minuto (no cada segundo para no distraer)
- [x] Usar `BlockingSession.startedAt` existente
- [x] Estilo discreto pero visible

### Parte 2: Resumen al Finalizar
- [x] Dialog de resumen aparece al terminar sesión de bloqueo
- [x] Muestra duración total de la sesión
- [x] Notificaciones bloqueadas agrupadas por app (ej: "Instagram: 5, WhatsApp: 3")
- [x] Total de "distracciones evitadas"
- [x] Opción de ver detalles (ir al historial) o descartar

## Implementation Summary

### Parte 1: ElapsedTimeCard en BlockingActivity
- Agregado `ElapsedTimeCard` composable en `BlockingActivity.kt:468-528`
- Usa `sessionStartTime` de `BlockingState`
- Actualiza cada 60 segundos vía `LaunchedEffect`
- Muestra: "Recién comenzaste" / "Llevas X minutos" / "Llevas Xh Ym enfocado"

### Parte 2: SessionSummaryDialog Integration
- Ya existía `SessionSummaryDialog.kt` - agregada duración de sesión al header
- Conectado `sessionEndedEvent` en `MainNavigationViewModel`
- Dialog aparece automáticamente cuando termina sesión con notificaciones bloqueadas
- "Ver todas" navega a `NotificationHistoryScreen`

### Archivos modificados
- `presentation/ui/blocking/BlockingActivity.kt` - ElapsedTimeCard
- `notifications/presentation/summary/SessionSummaryDialog.kt` - Duration subtitle
- `presentation/navigation/MainNavigation.kt` - Session event handling
- `presentation/navigation/UmbralNavHost.kt` - Navigation route + external nav support

## Dependencies

- [x] #76: Fix de cancelación de notificaciones

## Definition of Done

- [x] Timer visible en pantalla de bloqueo
- [x] Timer se actualiza correctamente cada minuto
- [x] Dialog de resumen aparece al finalizar
- [x] Resumen muestra duración y notificaciones bloqueadas
- [x] UX fluida y no intrusiva
- [x] Compilación exitosa
