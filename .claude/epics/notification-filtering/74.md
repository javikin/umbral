---
name: Agregar logging diagn√≥stico al servicio de notificaciones
status: closed
created: 2026-01-16T04:06:48Z
updated: 2026-01-16T04:29:34Z
closed_reason: already_implemented
github: https://github.com/javikin/umbral/issues/74
depends_on: [73]
parallel: false
conflicts_with: [75, 76]
---

# Task: Agregar logging diagn√≥stico al servicio de notificaciones

## Description

Agregar logging exhaustivo en `UmbralNotificationService` para diagnosticar exactamente d√≥nde est√° fallando el filtrado de notificaciones. Los logs deben capturar el estado completo en cada punto de decisi√≥n.

## Acceptance Criteria

- [ ] Logs en `onListenerConnected()` y `onListenerDisconnected()`
- [ ] Log detallado en cada `onNotificationPosted()` con: packageName, sessionId, blockedApps, decisi√≥n
- [ ] Log de √©xito/fallo de `cancelNotification()`
- [ ] Logs visibles en Logcat filtrando por "UmbralNotification"

## Technical Details

### Archivo a modificar
`app/src/main/java/com/umbral/notifications/service/UmbralNotificationService.kt`

### Logs a agregar

```kotlin
override fun onListenerConnected() {
    super.onListenerConnected()
    Timber.i("üîå NotificationListener CONNECTED - Service active")
}

override fun onListenerDisconnected() {
    super.onListenerDisconnected()
    Timber.w("üîå NotificationListener DISCONNECTED")
}

override fun onNotificationPosted(sbn: StatusBarNotification?) {
    sbn ?: return

    Timber.d("""
        üì¨ NOTIFICATION RECEIVED:
        - Package: ${sbn.packageName}
        - Key: ${sbn.key}
        - Session active: ${currentSessionId != null}
        - Session ID: $currentSessionId
        - Blocked apps (${blockedApps.size}): $blockedApps
        - Is blocked: ${sbn.packageName in blockedApps}
    """.trimIndent())

    // ... despu√©s de cancelNotification
    Timber.d("‚úÖ Notification cancelled: ${sbn.key}")
}
```

## Dependencies

- [ ] Task 001 completado (para aplicar hallazgos de investigaci√≥n)

## Effort Estimate

- Size: XS
- Hours: 0.5-1
- Parallel: false (modifica archivo cr√≠tico)

## Definition of Done

- [ ] Logging implementado
- [ ] App compilada exitosamente
- [ ] Logs visibles en Logcat durante prueba manual
- [ ] Informaci√≥n suficiente para diagnosticar el problema
