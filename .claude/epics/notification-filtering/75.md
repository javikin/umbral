---
name: Verificar y corregir inyección de dependencias (Hilt)
status: closed
created: 2026-01-16T04:06:48Z
updated: 2026-01-16T04:29:34Z
closed_reason: not_needed
github: https://github.com/javikin/umbral/issues/75
depends_on: [74]
parallel: false
conflicts_with: [74, 76]
---

# Task: Verificar y corregir inyección de dependencias (Hilt)

## Description

Verificar si `@AndroidEntryPoint` funciona correctamente con `NotificationListenerService`. Si Hilt no inyecta las dependencias correctamente, implementar inyección manual usando `EntryPointAccessors`.

## Acceptance Criteria

- [ ] Verificar en logs si `blockingManager` se inyecta correctamente (no es null)
- [ ] Verificar si `whitelistChecker` y `saveNotificationUseCase` se inyectan
- [ ] Si falla: implementar inyección manual con EntryPointAccessors
- [ ] Confirmar que el servicio tiene acceso a todas sus dependencias

## Technical Details

### Problema conocido
`NotificationListenerService` tiene un ciclo de vida especial manejado por el sistema. `@AndroidEntryPoint` de Hilt puede no funcionar correctamente porque el servicio no se instancia de la manera tradicional.

### Solución si Hilt falla

```kotlin
// Crear interface de entry point
@EntryPoint
@InstallIn(SingletonComponent::class)
interface NotificationServiceEntryPoint {
    fun blockingManager(): BlockingManager
    fun whitelistChecker(): NotificationWhitelistChecker
    fun saveNotificationUseCase(): SaveBlockedNotificationUseCase
}

// En el servicio, inyectar manualmente
class UmbralNotificationService : NotificationListenerService() {

    private lateinit var blockingManager: BlockingManager
    private lateinit var whitelistChecker: NotificationWhitelistChecker
    private lateinit var saveNotificationUseCase: SaveBlockedNotificationUseCase

    override fun onCreate() {
        super.onCreate()
        val entryPoint = EntryPointAccessors.fromApplication(
            applicationContext,
            NotificationServiceEntryPoint::class.java
        )
        blockingManager = entryPoint.blockingManager()
        whitelistChecker = entryPoint.whitelistChecker()
        saveNotificationUseCase = entryPoint.saveNotificationUseCase()
    }
}
```

### Archivos a modificar
- `app/src/main/java/com/umbral/notifications/service/UmbralNotificationService.kt`
- Posiblemente crear: `NotificationServiceEntryPoint.kt` en di/

## Dependencies

- [ ] Task 002 completado (logs para verificar estado de inyección)

## Effort Estimate

- Size: S
- Hours: 1-2
- Parallel: false (modifica servicio crítico)

## Definition of Done

- [ ] Dependencias verificadas como inyectadas correctamente
- [ ] Si fue necesario: EntryPointAccessors implementado
- [ ] Logs confirman que blockingManager no es null
- [ ] Servicio funciona con sus dependencias
