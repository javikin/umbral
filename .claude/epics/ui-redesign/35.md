---
name: Implementar Dark Mode Completo
status: closed
created: 2026-01-05T03:15:00Z
updated: 2026-01-05T03:15:00Z
github:
parallel: false
depends_on: [001]
effort: 4h
---

# Task: Implementar Dark Mode Completo

## Descripción

Asegurar que toda la app funcione correctamente en modo oscuro con colores apropiados y transiciones suaves.

## Paleta Dark Mode

```kotlin
// Dark theme colors
val DarkColorScheme = darkColorScheme(
    primary = Color(0xFF818CF8),          // Indigo más claro
    secondary = Color(0xFFA78BFA),        // Violeta más claro
    tertiary = Color(0xFF34D399),         // Verde menta
    background = Color(0xFF0F172A),       // Azul muy oscuro
    surface = Color(0xFF1E293B),          // Azul oscuro
    surfaceVariant = Color(0xFF334155),   // Gris azulado
    onPrimary = Color(0xFFFFFFFF),
    onSecondary = Color(0xFFFFFFFF),
    onBackground = Color(0xFFF8FAFC),     // Casi blanco
    onSurface = Color(0xFFF8FAFC),
    onSurfaceVariant = Color(0xFF94A3B8), // Gris claro
    outline = Color(0xFF475569),
    outlineVariant = Color(0xFF334155),
    error = Color(0xFFF87171),            // Rojo más suave
    errorContainer = Color(0xFF7F1D1D)
)
```

## Áreas a Verificar

### 1. Colores de Texto

```kotlin
// Verificar contraste WCAG AA (4.5:1 para texto normal)
// onSurface sobre surface: OK
// onSurfaceVariant sobre surface: verificar

@Composable
fun ThemedText(
    text: String,
    emphasis: TextEmphasis = TextEmphasis.High
) {
    val color = when (emphasis) {
        TextEmphasis.High -> MaterialTheme.colorScheme.onSurface
        TextEmphasis.Medium -> MaterialTheme.colorScheme.onSurfaceVariant
        TextEmphasis.Disabled -> MaterialTheme.colorScheme.onSurface.copy(alpha = 0.38f)
    }

    Text(text = text, color = color)
}
```

### 2. Iconos

```kotlin
// Iconos deben usar tint apropiado
@Composable
fun ThemedIcon(
    imageVector: ImageVector,
    contentDescription: String?,
    emphasis: IconEmphasis = IconEmphasis.Medium
) {
    val tint = when (emphasis) {
        IconEmphasis.High -> MaterialTheme.colorScheme.onSurface
        IconEmphasis.Medium -> MaterialTheme.colorScheme.onSurfaceVariant
        IconEmphasis.Primary -> MaterialTheme.colorScheme.primary
    }

    Icon(
        imageVector = imageVector,
        contentDescription = contentDescription,
        tint = tint
    )
}
```

### 3. Cards y Surfaces

```kotlin
// Cards en dark mode usan surface, no background
@Composable
fun UmbralCard(...) {
    Card(
        colors = CardDefaults.cardColors(
            containerColor = MaterialTheme.colorScheme.surface
        ),
        elevation = CardDefaults.cardElevation(
            // Menos sombra en dark mode (sombras no se ven bien)
            defaultElevation = if (isSystemInDarkTheme()) 0.dp else 2.dp
        )
    )
}
```

### 4. Gradientes

```kotlin
// Gradientes ajustados para dark mode
@Composable
fun StatusGradient(isActive: Boolean): Brush {
    val isDark = isSystemInDarkTheme()

    return if (isActive) {
        Brush.linearGradient(
            colors = if (isDark) {
                listOf(
                    Color(0xFF4F46E5).copy(alpha = 0.8f),
                    Color(0xFF7C3AED).copy(alpha = 0.8f)
                )
            } else {
                listOf(
                    UmbralPrimary,
                    UmbralSecondary
                )
            }
        )
    } else {
        Brush.linearGradient(
            colors = listOf(
                MaterialTheme.colorScheme.surface,
                MaterialTheme.colorScheme.surface
            )
        )
    }
}
```

### 5. Imágenes e Ilustraciones

```kotlin
// Ilustraciones con versiones dark
@Composable
fun ThemedIllustration(
    lightRes: Int,
    darkRes: Int,
    contentDescription: String?
) {
    val res = if (isSystemInDarkTheme()) darkRes else lightRes

    Image(
        painter = painterResource(res),
        contentDescription = contentDescription
    )
}

// O con tint overlay para simplificar
@Composable
fun ThemedIllustration(res: Int) {
    val isDark = isSystemInDarkTheme()

    Box {
        Image(painter = painterResource(res), ...)

        if (isDark) {
            // Overlay sutil para adaptar
            Box(
                modifier = Modifier
                    .matchParentSize()
                    .background(Color.Black.copy(alpha = 0.1f))
            )
        }
    }
}
```

### 6. Status Bar y Navigation Bar

```kotlin
// En MainActivity o Theme
@Composable
fun UmbralTheme(
    darkTheme: Boolean = isSystemInDarkTheme(),
    content: @Composable () -> Unit
) {
    val view = LocalView.current

    if (!view.isInEditMode) {
        SideEffect {
            val window = (view.context as Activity).window

            // Status bar
            window.statusBarColor = if (darkTheme) {
                DarkBackground.toArgb()
            } else {
                LightBackground.toArgb()
            }

            // Navigation bar
            window.navigationBarColor = if (darkTheme) {
                DarkBackground.toArgb()
            } else {
                LightBackground.toArgb()
            }

            // Icon colors
            WindowCompat.getInsetsController(window, view).apply {
                isAppearanceLightStatusBars = !darkTheme
                isAppearanceLightNavigationBars = !darkTheme
            }
        }
    }

    MaterialTheme(
        colorScheme = if (darkTheme) DarkColorScheme else LightColorScheme,
        ...
    )
}
```

## Transición entre Temas

```kotlin
// Animación suave al cambiar tema
@Composable
fun AnimatedThemeSwitch(
    darkTheme: Boolean,
    content: @Composable () -> Unit
) {
    val colors by animateColorSchemeAsState(
        targetColorScheme = if (darkTheme) DarkColorScheme else LightColorScheme,
        animationSpec = tween(500)
    )

    MaterialTheme(
        colorScheme = colors,
        content = content
    )
}

// Helper function
@Composable
fun animateColorSchemeAsState(
    targetColorScheme: ColorScheme,
    animationSpec: AnimationSpec<Color> = tween(500)
): State<ColorScheme> {
    val primary by animateColorAsState(targetColorScheme.primary, animationSpec)
    val background by animateColorAsState(targetColorScheme.background, animationSpec)
    // ... más colores

    return remember(primary, background, ...) {
        mutableStateOf(
            targetColorScheme.copy(
                primary = primary,
                background = background,
                // ...
            )
        )
    }
}
```

## Testing Dark Mode

### Previews

```kotlin
@Preview(name = "Light")
@Preview(name = "Dark", uiMode = Configuration.UI_MODE_NIGHT_YES)
@Composable
fun ComponentPreview() {
    UmbralTheme {
        // Component
    }
}
```

### Checklist Visual

- [ ] Texto legible sobre todos los fondos
- [ ] Iconos visibles con contraste suficiente
- [ ] Cards distinguibles del fondo
- [ ] Gradientes no demasiado brillantes
- [ ] Status/nav bars con colores correctos
- [ ] Ilustraciones adaptadas
- [ ] Sin "white flash" en transiciones

## Archivos a Modificar

- `Theme.kt` - Dark color scheme completo
- `Color.kt` - Colores dark específicos
- Todos los componentes - Verificar uso de theme colors
- `MainActivity.kt` - System bars

## Criterios de Aceptación

- [ ] Dark mode activable desde Settings
- [ ] Respeta configuración del sistema
- [ ] Contraste WCAG AA en todo texto
- [ ] Sin colores hardcoded
- [ ] System bars con colores correctos
- [ ] Transición suave entre temas
- [ ] Todas las pantallas revisadas
