---
name: fix-apps-list-empty
status: open
priority: critical
github: https://github.com/javikin/umbral/issues/23
created: 2026-01-04T23:34:58Z
updated: 2026-01-04T23:34:58Z
depends_on: []
parallel: true
---

# Task 1: Fix Lista de Apps Vacía

## Problema

El selector de apps no muestra ninguna aplicación instalada en Android 16 (API 36).

## Causa Raíz

En Android 11+ (API 30+), las apps necesitan declarar qué paquetes pueden consultar debido a "Package Visibility".

## Solución

### 1. Actualizar AndroidManifest.xml

```xml
<manifest>
    <!-- Opción A: Query all packages (puede requerir justificación en Play Store) -->
    <uses-permission android:name="android.permission.QUERY_ALL_PACKAGES" />

    <!-- Opción B: Query solo apps con launcher (recomendado) -->
    <queries>
        <intent>
            <action android:name="android.intent.action.MAIN" />
            <category android:name="android.intent.category.LAUNCHER" />
        </intent>
    </queries>
</manifest>
```

### 2. Verificar InstalledAppsRepository

```kotlin
// Asegurar que usa el flag correcto
packageManager.getInstalledApplications(PackageManager.GET_META_DATA)
```

### 3. Agregar Logging para Debug

```kotlin
Log.d("AppsRepo", "Found ${apps.size} installed apps")
```

## Archivos a Modificar

- `app/src/main/AndroidManifest.xml`
- `app/src/main/java/com/umbral/data/apps/InstalledAppsRepositoryImpl.kt`

## Criterio de Done

- [ ] Apps instaladas aparecen en la lista
- [ ] Apps del sistema están filtradas (opcional mostrar)
- [ ] Probado en Android 16 (Pixel 8 Pro)
- [ ] Sin warnings de permisos en build

## Testing

```bash
# Reinstalar y verificar
./gradlew installDebug
adb shell am start -n com.umbral.debug/.MainActivity
```
