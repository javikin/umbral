---
name: Assets + Polish + Testing
status: open
created: 2026-01-07T05:02:20Z
updated: 2026-01-07T05:13:26Z
github: https://github.com/javikin/umbral/issues/61
depends_on: [53, 54, 55, 56, 57, 58, 59, 60]
parallel: false
conflicts_with: []
---

# Task: Assets + Polish + Testing

## Description

Integrar todos los assets visuales (ilustraciones, animaciones Lottie), pulir la UI, realizar testing en dispositivo, y corregir bugs encontrados. Este es el task final antes de release.

## Acceptance Criteria

- [ ] Todos los assets de compañeros integrados (24 ilustraciones)
- [ ] Todas las animaciones Lottie funcionando (35+)
- [ ] Assets del mapa del Bosque integrados
- [ ] UI pulida y consistente
- [ ] Testing en dispositivo real completado
- [ ] Bugs críticos corregidos
- [ ] Performance validada (<16ms frame time)
- [ ] APK size dentro de límite (+15MB max)

## Technical Details

### 1. Assets Checklist

#### Compañeros (24 ilustraciones WebP)
```
res/drawable/expedition/companions/
├── lumina_1.webp      # Estado 1
├── lumina_2.webp      # Estado 2
├── lumina_3.webp      # Estado 3
├── terra_1.webp
├── terra_2.webp
├── terra_3.webp
├── aqua_1.webp
├── aqua_2.webp
├── aqua_3.webp
├── ventus_1.webp
├── ventus_2.webp
├── ventus_3.webp
├── flora_1.webp
├── flora_2.webp
├── flora_3.webp
├── ignis_1.webp
├── ignis_2.webp
├── ignis_3.webp
├── noctis_1.webp
├── noctis_2.webp
├── noctis_3.webp
├── aurora_1.webp
├── aurora_2.webp
└── aurora_3.webp
```

#### Locaciones (15 ilustraciones WebP)
```
res/drawable/expedition/locations/
├── forest_entrance.webp
├── old_oak.webp
├── mushroom_grove.webp
├── hidden_pond.webp
├── fairy_circle.webp
├── mossy_cave.webp
├── waterfall.webp
├── ancient_ruins.webp
├── flower_meadow.webp
├── owl_tree.webp
├── crystal_cave.webp
├── summit_view.webp
├── sacred_grove.webp
├── dragon_cave.webp
└── heart_of_forest.webp
```

#### Mapa Base
```
res/drawable/expedition/
├── forest_biome_map.webp      # Mapa completo
├── forest_biome_fog.webp      # Overlay de niebla
└── map_markers.webp           # Sprite sheet de marcadores
```

#### Animaciones Lottie (35 JSON)
```
res/raw/
├── companion_idle_generic.json
├── companion_happy_generic.json
├── evolution_effect.json
├── capture_success.json
├── discovery_reveal.json
├── achievement_unlock.json
├── energy_gain.json
├── level_up.json
├── streak_fire.json
├── particles_ambient.json
└── companions/
    ├── lumina_idle.json
    ├── lumina_happy.json
    ├── terra_idle.json
    ├── terra_happy.json
    ├── aqua_idle.json
    ├── aqua_happy.json
    ├── ventus_idle.json
    ├── ventus_happy.json
    ├── flora_idle.json
    ├── flora_happy.json
    ├── ignis_idle.json
    ├── ignis_happy.json
    ├── noctis_idle.json
    ├── noctis_happy.json
    ├── aurora_idle.json
    └── aurora_happy.json
```

### 2. Asset Loading Helper

```kotlin
// ExpeditionAssets.kt
object ExpeditionAssets {
    @DrawableRes
    fun companionImage(type: CompanionType, evolutionState: Int): Int {
        val name = "${type.name.lowercase()}_$evolutionState"
        return when (name) {
            "lumina_1" -> R.drawable.lumina_1
            "lumina_2" -> R.drawable.lumina_2
            "lumina_3" -> R.drawable.lumina_3
            // ... all mappings
            else -> R.drawable.companion_placeholder
        }
    }

    @DrawableRes
    fun locationImage(locationId: String): Int {
        return when (locationId) {
            "forest_entrance" -> R.drawable.forest_entrance
            "old_oak" -> R.drawable.old_oak
            // ... all mappings
            else -> R.drawable.location_placeholder
        }
    }

    fun companionLottie(type: CompanionType, state: CompanionAnimationState): String {
        val typeName = type.name.lowercase()
        return when (state) {
            CompanionAnimationState.IDLE -> "companions/${typeName}_idle.json"
            CompanionAnimationState.HAPPY -> "companions/${typeName}_happy.json"
            CompanionAnimationState.EVOLVING -> "evolution_effect.json"
        }
    }
}
```

### 3. Image Loading with Coil

```kotlin
// CompanionImage.kt
@Composable
fun CompanionImage(
    type: CompanionType,
    evolutionState: Int,
    modifier: Modifier = Modifier
) {
    val imageRes = ExpeditionAssets.companionImage(type, evolutionState)

    AsyncImage(
        model = ImageRequest.Builder(LocalContext.current)
            .data(imageRes)
            .crossfade(true)
            .build(),
        contentDescription = type.displayName,
        modifier = modifier,
        contentScale = ContentScale.Fit,
        placeholder = painterResource(R.drawable.companion_placeholder),
        error = painterResource(R.drawable.companion_placeholder)
    )
}

// LocationImage.kt
@Composable
fun LocationImage(
    locationId: String,
    modifier: Modifier = Modifier
) {
    val imageRes = ExpeditionAssets.locationImage(locationId)

    AsyncImage(
        model = ImageRequest.Builder(LocalContext.current)
            .data(imageRes)
            .crossfade(true)
            .build(),
        contentDescription = null,
        modifier = modifier,
        contentScale = ContentScale.Crop
    )
}
```

### 4. Polish Tasks

#### UI Consistency
- [ ] Verificar todos los colores usan MaterialTheme
- [ ] Verificar tipografía consistente
- [ ] Verificar spacing usando UmbralSpacing
- [ ] Verificar elevaciones usando UmbralElevation
- [ ] Dark mode funciona correctamente

#### Animations
- [ ] Todas las transiciones son suaves
- [ ] No hay saltos en animaciones
- [ ] Lottie animations loop correctamente
- [ ] Fallbacks funcionan si animation falla

#### Accessibility
- [ ] ContentDescription en todas las imágenes
- [ ] Contraste suficiente en textos
- [ ] Touch targets >= 48dp
- [ ] Screen reader funciona

### 5. Testing Checklist

#### Functional Testing
- [ ] Ganar energía al completar sesión
- [ ] XP incrementa correctamente
- [ ] Level up funciona
- [ ] Streak multiplier aplicado
- [ ] Descubrir locación resta energía
- [ ] Fog of war se revela
- [ ] Capturar compañero funciona
- [ ] Evolucionar compañero funciona
- [ ] Logros se desbloquean
- [ ] Estrellas se otorgan

#### Edge Cases
- [ ] Fresh install sin datos previos
- [ ] Usuario con datos existentes (migration)
- [ ] Sin energía suficiente para acciones
- [ ] Todos los compañeros capturados
- [ ] Todas las locaciones descubiertas
- [ ] Nivel máximo alcanzado
- [ ] Sesión muy corta (<1 min)
- [ ] Sesión muy larga (>2 horas)

#### Performance Testing
```kotlin
// Performance checks
- Frame time promedio: < 16ms
- Memory heap: < 200MB total app
- APK size delta: < 15MB
- Startup time delta: < 500ms
- Lottie animation: 60fps
- Map scroll: 60fps
```

#### Device Testing
- [ ] Pixel 6 (Android 14)
- [ ] Samsung Galaxy S21 (Android 13)
- [ ] Xiaomi device (MIUI)
- [ ] Low-end device (4GB RAM)
- [ ] Tablet (si es aplicable)

### 6. Bug Fix Template

```kotlin
/**
 * Bug: [Description]
 * Steps to reproduce:
 * 1. ...
 * 2. ...
 * Expected: ...
 * Actual: ...
 * Fix: ...
 */
```

### 7. Pre-Release Checklist

- [ ] Todos los TODOs resueltos
- [ ] No hay código comentado innecesario
- [ ] No hay logs de debug en release
- [ ] ProGuard rules actualizadas
- [ ] Version code/name actualizados
- [ ] Changelog actualizado
- [ ] Screenshots para Play Store

## Dependencies

- [ ] Todos los tasks anteriores completados

## Effort Estimate

- Size: L
- Hours: 8
- Parallel: false

## Definition of Done

- [ ] Assets 100% integrados
- [ ] UI pulida sin issues visuales
- [ ] Testing completo sin bugs críticos
- [ ] Performance dentro de targets
- [ ] Ready for release
