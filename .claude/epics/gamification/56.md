---
name: Sistema de Logros completo
status: open
created: 2026-01-07T05:02:20Z
updated: 2026-01-07T05:13:26Z
github: https://github.com/javikin/umbral/issues/56
depends_on: []
parallel: true
conflicts_with: []
---

# Task: Sistema de Logros completo

## Description

Implementar el sistema completo de logros con 30 achievements, categorías, seguimiento de progreso, y lógica de desbloqueo automático basado en eventos del juego.

## Acceptance Criteria

- [ ] 30 logros definidos en AchievementDefinitions
- [ ] 4 categorías: blocking, exploration, companion, milestone
- [ ] CheckAchievementsUseCase evalúa progreso automáticamente
- [ ] AchievementsScreen muestra logros con progreso
- [ ] Animación de desbloqueo (Lottie placeholder)
- [ ] Estrellas otorgadas al desbloquear
- [ ] Persistencia en Room

## Technical Details

### 1. Achievement Definitions

```kotlin
// AchievementDefinitions.kt
object AchievementDefinitions {
    val ALL: List<AchievementDef> = listOf(
        // BLOCKING (10)
        AchievementDef("first_step", Category.BLOCKING, "Primer Paso",
            "Completa tu primera sesión", 1, 5),
        AchievementDef("golden_hour", Category.BLOCKING, "Hora Dorada",
            "60 minutos en una sesión", 60, 10),
        AchievementDef("marathoner", Category.BLOCKING, "Maratonista",
            "120 minutos en una sesión", 120, 20),
        AchievementDef("consistent_7", Category.BLOCKING, "Consistente",
            "7 días seguidos", 7, 15),
        AchievementDef("dedicated_14", Category.BLOCKING, "Dedicado",
            "14 días seguidos", 14, 25),
        AchievementDef("master_30", Category.BLOCKING, "Maestro",
            "30 días seguidos", 30, 50),
        AchievementDef("centurion", Category.BLOCKING, "Centurión",
            "100 sesiones totales", 100, 30),
        AchievementDef("thousand_min", Category.BLOCKING, "Mil Minutos",
            "1000 min bloqueados", 1000, 25),
        AchievementDef("iron_will", Category.BLOCKING, "Voluntad de Hierro",
            "5000 min bloqueados", 5000, 50),
        AchievementDef("legend", Category.BLOCKING, "Leyenda",
            "10000 min bloqueados", 10000, 100),

        // EXPLORATION (10)
        AchievementDef("novice_explorer", Category.EXPLORATION, "Explorador Novato",
            "Descubre tu primera locación", 1, 5),
        AchievementDef("cartographer", Category.EXPLORATION, "Cartógrafo",
            "Descubre 5 locaciones", 5, 10),
        AchievementDef("adventurer", Category.EXPLORATION, "Aventurero",
            "Descubre 10 locaciones", 10, 20),
        AchievementDef("master_explorer", Category.EXPLORATION, "Maestro Explorador",
            "Descubre las 15 locaciones", 15, 50),
        AchievementDef("lore_reader_5", Category.EXPLORATION, "Lector de Lore",
            "Lee 5 historias", 5, 10),
        AchievementDef("historian", Category.EXPLORATION, "Historiador",
            "Lee todas las historias", 15, 30),
        AchievementDef("biome_complete", Category.EXPLORATION, "Bioma Completo",
            "100% del Bosque", 100, 50),
        AchievementDef("collector", Category.EXPLORATION, "Coleccionista",
            "Todos los compañeros base", 8, 40),
        AchievementDef("no_stone", Category.EXPLORATION, "Sin Piedra Sin Voltear",
            "Encuentra todos los secretos", 5, 25),
        AchievementDef("speedrunner", Category.EXPLORATION, "Speedrunner",
            "Completa bioma en <14 días", 1, 75),

        // COMPANION (10)
        AchievementDef("first_friend", Category.COMPANION, "Primer Amigo",
            "Captura tu primer compañero", 1, 5),
        AchievementDef("duo", Category.COMPANION, "Dúo",
            "2 compañeros", 2, 10),
        AchievementDef("team", Category.COMPANION, "Equipo",
            "4 compañeros", 4, 20),
        AchievementDef("all_together", Category.COMPANION, "Todos Juntos",
            "8 compañeros", 8, 40),
        AchievementDef("first_evolution", Category.COMPANION, "Primera Evolución",
            "Evoluciona por primera vez", 1, 15),
        AchievementDef("evolutionist", Category.COMPANION, "Evolucionista",
            "3 evoluciones", 3, 25),
        AchievementDef("master_breeder", Category.COMPANION, "Maestro Criador",
            "Todas las evoluciones (24)", 24, 100),
        AchievementDef("best_friend", Category.COMPANION, "Mejor Amigo",
            "1000 Energía en un compañero", 1000, 20),
        AchievementDef("eternal_bond", Category.COMPANION, "Vínculo Eterno",
            "Evolución máxima", 1, 30),
        AchievementDef("full_sanctuary", Category.COMPANION, "Santuario Lleno",
            "Todos los compañeros max evo", 8, 150)
    )

    enum class Category { BLOCKING, EXPLORATION, COMPANION, MILESTONE }
}

data class AchievementDef(
    val id: String,
    val category: AchievementDefinitions.Category,
    val title: String,
    val description: String,
    val target: Int,
    val starsReward: Int
)
```

### 2. CheckAchievementsUseCase

```kotlin
class CheckAchievementsUseCase @Inject constructor(
    private val repository: ExpeditionRepository
) {
    suspend fun checkBlockingAchievements(
        sessionMinutes: Int,
        totalMinutes: Int,
        currentStreak: Int,
        totalSessions: Int
    ): List<UnlockedAchievement> {
        val unlocked = mutableListOf<UnlockedAchievement>()

        // Check session-based
        if (sessionMinutes >= 60) {
            checkAndUnlock("golden_hour", 60)?.let { unlocked.add(it) }
        }
        if (sessionMinutes >= 120) {
            checkAndUnlock("marathoner", 120)?.let { unlocked.add(it) }
        }

        // Check total-based
        updateProgress("thousand_min", totalMinutes)
        updateProgress("iron_will", totalMinutes)
        updateProgress("legend", totalMinutes)

        // Check streak-based
        updateProgress("consistent_7", currentStreak)
        updateProgress("dedicated_14", currentStreak)
        updateProgress("master_30", currentStreak)

        // Check session count
        updateProgress("centurion", totalSessions)

        // First session
        if (totalSessions == 1) {
            checkAndUnlock("first_step", 1)?.let { unlocked.add(it) }
        }

        return unlocked
    }

    private suspend fun checkAndUnlock(id: String, progress: Int): UnlockedAchievement? {
        val achievement = repository.getAchievement(id) ?: return null
        if (achievement.unlockedAt != null) return null

        if (progress >= achievement.target) {
            repository.unlockAchievement(id)
            return UnlockedAchievement(
                id = id,
                title = AchievementDefinitions.ALL.find { it.id == id }?.title ?: "",
                starsEarned = achievement.starsReward
            )
        }
        return null
    }

    private suspend fun updateProgress(id: String, progress: Int) {
        repository.updateAchievementProgress(id, progress)
    }
}

data class UnlockedAchievement(
    val id: String,
    val title: String,
    val starsEarned: Int
)
```

### 3. AchievementsScreen

```kotlin
@Composable
fun AchievementsScreen(
    viewModel: AchievementsViewModel = hiltViewModel(),
    onBack: () -> Unit
) {
    val uiState by viewModel.uiState.collectAsState()

    Scaffold(
        topBar = {
            TopAppBar(
                title = { Text("Logros") },
                navigationIcon = {
                    IconButton(onClick = onBack) {
                        Icon(Icons.Default.ArrowBack, "Volver")
                    }
                }
            )
        }
    ) { padding ->
        LazyColumn(
            modifier = Modifier.padding(padding),
            contentPadding = PaddingValues(16.dp),
            verticalArrangement = Arrangement.spacedBy(12.dp)
        ) {
            // Stats header
            item {
                AchievementStats(
                    unlocked = uiState.unlockedCount,
                    total = uiState.totalCount,
                    stars = uiState.totalStars
                )
            }

            // By category
            AchievementDefinitions.Category.values().forEach { category ->
                val categoryAchievements = uiState.achievements
                    .filter { it.category == category.name.lowercase() }

                if (categoryAchievements.isNotEmpty()) {
                    item {
                        Text(
                            text = category.displayName,
                            style = MaterialTheme.typography.titleMedium,
                            modifier = Modifier.padding(vertical = 8.dp)
                        )
                    }

                    items(categoryAchievements) { achievement ->
                        AchievementCard(
                            achievement = achievement,
                            definition = AchievementDefinitions.ALL
                                .find { it.id == achievement.id }
                        )
                    }
                }
            }
        }
    }
}

@Composable
fun AchievementCard(
    achievement: AchievementEntity,
    definition: AchievementDef?
) {
    val isUnlocked = achievement.unlockedAt != null
    val progress = achievement.progress.toFloat() / achievement.target

    UmbralCard(
        modifier = Modifier.fillMaxWidth(),
        elevation = if (isUnlocked) UmbralElevation.Medium else UmbralElevation.Low
    ) {
        Row(
            modifier = Modifier.padding(16.dp),
            verticalAlignment = Alignment.CenterVertically
        ) {
            // Icon/Badge
            Box(
                modifier = Modifier
                    .size(48.dp)
                    .clip(CircleShape)
                    .background(
                        if (isUnlocked) MaterialTheme.colorScheme.primary
                        else MaterialTheme.colorScheme.surfaceVariant
                    ),
                contentAlignment = Alignment.Center
            ) {
                Icon(
                    imageVector = if (isUnlocked) Icons.Default.Star else Icons.Default.Lock,
                    contentDescription = null,
                    tint = if (isUnlocked) MaterialTheme.colorScheme.onPrimary
                           else MaterialTheme.colorScheme.onSurfaceVariant
                )
            }

            Spacer(modifier = Modifier.width(16.dp))

            Column(modifier = Modifier.weight(1f)) {
                Text(
                    text = definition?.title ?: achievement.id,
                    style = MaterialTheme.typography.titleSmall,
                    fontWeight = FontWeight.Bold
                )
                Text(
                    text = definition?.description ?: "",
                    style = MaterialTheme.typography.bodySmall,
                    color = MaterialTheme.colorScheme.onSurfaceVariant
                )

                if (!isUnlocked) {
                    Spacer(modifier = Modifier.height(8.dp))
                    LinearProgressIndicator(
                        progress = { progress },
                        modifier = Modifier.fillMaxWidth()
                    )
                    Text(
                        text = "${achievement.progress}/${achievement.target}",
                        style = MaterialTheme.typography.labelSmall
                    )
                }
            }

            // Stars reward
            Row(verticalAlignment = Alignment.CenterVertically) {
                Text(
                    text = "+${definition?.starsReward ?: 0}",
                    style = MaterialTheme.typography.labelMedium,
                    color = if (isUnlocked) MaterialTheme.colorScheme.primary
                            else MaterialTheme.colorScheme.outline
                )
                Icon(
                    imageVector = Icons.Default.Star,
                    contentDescription = null,
                    modifier = Modifier.size(16.dp),
                    tint = if (isUnlocked) MaterialTheme.colorScheme.primary
                           else MaterialTheme.colorScheme.outline
                )
            }
        }
    }
}
```

## Dependencies

- [ ] Puede desarrollarse en paralelo (solo necesita DAOs básicos)

## Effort Estimate

- Size: M
- Hours: 6
- Parallel: true

## Definition of Done

- [ ] 30 logros definidos correctamente
- [ ] CheckAchievementsUseCase evalúa todos los triggers
- [ ] AchievementsScreen muestra todas las categorías
- [ ] Progreso se actualiza en tiempo real
- [ ] Estrellas se otorgan al desbloquear
- [ ] UI responsive y accesible
