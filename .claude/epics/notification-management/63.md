---
name: NotificationListenerService básico + permisos
status: open
created: 2026-01-07T20:19:34Z
updated: 2026-01-07T20:28:45Z
github: https://github.com/javikin/umbral/issues/63
depends_on: []
parallel: true
conflicts_with: []
---

# Task: NotificationListenerService básico + permisos

## Description

Implementar el servicio base `UmbralNotificationService` que extiende `NotificationListenerService` de Android para interceptar notificaciones del sistema. Incluye la configuración de permisos necesarios y una UI básica para guiar al usuario a habilitar el permiso.

## Acceptance Criteria

- [ ] `UmbralNotificationService` extiende `NotificationListenerService`
- [ ] Servicio declarado en AndroidManifest.xml con intent-filter correcto
- [ ] Callback `onNotificationPosted()` captura notificaciones entrantes
- [ ] Callback `onNotificationRemoved()` registra notificaciones eliminadas
- [ ] UI de onboarding que explica por qué se necesita el permiso
- [ ] Botón que lleva a Settings > Notification Access
- [ ] Verificación de si el permiso está habilitado
- [ ] Log básico de notificaciones capturadas (para debugging)

## Technical Details

### Files to Create
```
app/src/main/java/com/umbral/notifications/
├── service/
│   └── UmbralNotificationService.kt
└── util/
    └── NotificationPermissionHelper.kt
```

### AndroidManifest.xml additions
```xml
<service
    android:name=".notifications.service.UmbralNotificationService"
    android:permission="android.permission.BIND_NOTIFICATION_LISTENER_SERVICE"
    android:exported="false">
    <intent-filter>
        <action android:name="android.service.notification.NotificationListenerService" />
    </intent-filter>
</service>
```

### Key Implementation
```kotlin
class UmbralNotificationService : NotificationListenerService() {

    override fun onNotificationPosted(sbn: StatusBarNotification?) {
        sbn ?: return
        // Log or process notification
        val packageName = sbn.packageName
        val title = sbn.notification.extras.getString(Notification.EXTRA_TITLE)
        val text = sbn.notification.extras.getString(Notification.EXTRA_TEXT)
    }

    override fun onNotificationRemoved(sbn: StatusBarNotification?) {
        // Optional: track removed notifications
    }
}
```

### Permission Check
```kotlin
object NotificationPermissionHelper {
    fun isNotificationListenerEnabled(context: Context): Boolean {
        val enabledListeners = Settings.Secure.getString(
            context.contentResolver,
            "enabled_notification_listeners"
        )
        return enabledListeners?.contains(context.packageName) == true
    }

    fun openNotificationListenerSettings(context: Context) {
        context.startActivity(Intent(Settings.ACTION_NOTIFICATION_LISTENER_SETTINGS))
    }
}
```

## Dependencies

- [ ] No dependencies on other tasks
- [ ] Android API level 21+ (already met)

## Effort Estimate

- Size: M
- Hours: 4
- Parallel: true

## Definition of Done

- [ ] Service compiles and installs without errors
- [ ] Permission helper functions work correctly
- [ ] Service appears in Settings > Notification Access
- [ ] When enabled, service logs incoming notifications
- [ ] Basic onboarding UI shows permission explanation
