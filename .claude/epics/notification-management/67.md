---
name: SessionSummaryDialog post-sesi√≥n
status: open
created: 2026-01-07T20:19:34Z
updated: 2026-01-07T20:28:45Z
github: https://github.com/javikin/umbral/issues/67
depends_on: [66]
parallel: true
conflicts_with: [68]
---

# Task: SessionSummaryDialog post-sesi√≥n

## Description

Crear el di√°logo que se muestra autom√°ticamente cuando termina una sesi√≥n de bloqueo, mostrando un resumen de las notificaciones bloqueadas, desglose por app, y la energ√≠a bonus ganada.

## Acceptance Criteria

- [ ] Di√°logo se muestra al terminar sesi√≥n de bloqueo
- [ ] Muestra total de notificaciones bloqueadas
- [ ] Muestra top 5 apps con m√°s notificaciones
- [ ] Muestra energ√≠a bonus calculada (+1 por cada 5)
- [ ] Bot√≥n "Ver todas" navega a historial
- [ ] Bot√≥n "Descartar" cierra el di√°logo
- [ ] Animaci√≥n de entrada suave
- [ ] Dise√±o Material Design 3

## Technical Details

### Files to Create
```
app/src/main/java/com/umbral/notifications/presentation/summary/
‚îú‚îÄ‚îÄ SessionSummaryDialog.kt
‚îú‚îÄ‚îÄ SessionSummaryState.kt
‚îî‚îÄ‚îÄ SessionSummaryViewModel.kt
```

### UI Design
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                        ‚îÇ
‚îÇ     üõ°Ô∏è ¬°Sesi√≥n completada!            ‚îÇ
‚îÇ                                        ‚îÇ
‚îÇ     Evitaste 23 distracciones         ‚îÇ
‚îÇ                                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ üì± Instagram        8          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ üê¶ Twitter          6          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ üí¨ WhatsApp         5          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ üì∫ YouTube          3          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ üìß Gmail            1          ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                        ‚îÇ
‚îÇ     ‚ö° +4 energ√≠a bonus               ‚îÇ
‚îÇ                                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  Ver todas   ‚îÇ  ‚îÇ   Descartar  ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Dialog Composable
```kotlin
@Composable
fun SessionSummaryDialog(
    summary: NotificationSummary,
    bonusEnergy: Int,
    onViewAll: () -> Unit,
    onDismiss: () -> Unit,
    modifier: Modifier = Modifier
) {
    Dialog(
        onDismissRequest = onDismiss,
        properties = DialogProperties(
            dismissOnBackPress = true,
            dismissOnClickOutside = false
        )
    ) {
        Surface(
            shape = MaterialTheme.shapes.large,
            color = MaterialTheme.colorScheme.surface,
            tonalElevation = 6.dp
        ) {
            Column(
                modifier = Modifier.padding(24.dp),
                horizontalAlignment = Alignment.CenterHorizontally
            ) {
                // Shield icon
                Icon(
                    imageVector = Icons.Outlined.Shield,
                    contentDescription = null,
                    modifier = Modifier.size(48.dp),
                    tint = MaterialTheme.colorScheme.primary
                )

                Spacer(modifier = Modifier.height(16.dp))

                // Title
                Text(
                    text = "¬°Sesi√≥n completada!",
                    style = MaterialTheme.typography.headlineSmall
                )

                Spacer(modifier = Modifier.height(8.dp))

                // Subtitle
                Text(
                    text = "Evitaste ${summary.totalCount} distracciones",
                    style = MaterialTheme.typography.bodyLarge,
                    color = MaterialTheme.colorScheme.onSurfaceVariant
                )

                Spacer(modifier = Modifier.height(24.dp))

                // App breakdown
                summary.byApp.take(5).forEach { app ->
                    AppNotificationRow(app)
                }

                Spacer(modifier = Modifier.height(16.dp))

                // Energy bonus
                if (bonusEnergy > 0) {
                    EnergyBonusChip(bonusEnergy)
                }

                Spacer(modifier = Modifier.height(24.dp))

                // Buttons
                Row(
                    horizontalArrangement = Arrangement.spacedBy(12.dp)
                ) {
                    OutlinedButton(onClick = onViewAll) {
                        Text("Ver todas")
                    }
                    Button(onClick = onDismiss) {
                        Text("Descartar")
                    }
                }
            }
        }
    }
}

@Composable
private fun AppNotificationRow(app: NotificationSummary.AppCount) {
    Row(
        modifier = Modifier
            .fillMaxWidth()
            .padding(vertical = 4.dp),
        horizontalArrangement = Arrangement.SpaceBetween
    ) {
        Text(
            text = app.appName,
            style = MaterialTheme.typography.bodyMedium
        )
        Text(
            text = app.count.toString(),
            style = MaterialTheme.typography.bodyMedium,
            fontWeight = FontWeight.Bold
        )
    }
}

@Composable
private fun EnergyBonusChip(energy: Int) {
    Surface(
        shape = MaterialTheme.shapes.small,
        color = MaterialTheme.colorScheme.primaryContainer
    ) {
        Row(
            modifier = Modifier.padding(horizontal = 12.dp, vertical = 6.dp),
            verticalAlignment = Alignment.CenterVertically
        ) {
            Icon(
                imageVector = Icons.Default.Bolt,
                contentDescription = null,
                modifier = Modifier.size(16.dp)
            )
            Spacer(modifier = Modifier.width(4.dp))
            Text(
                text = "+$energy energ√≠a bonus",
                style = MaterialTheme.typography.labelMedium
            )
        }
    }
}
```

### ViewModel
```kotlin
@HiltViewModel
class SessionSummaryViewModel @Inject constructor(
    private val getSummaryUseCase: GetNotificationSummaryUseCase,
    savedStateHandle: SavedStateHandle
) : ViewModel() {

    private val _state = MutableStateFlow(SessionSummaryState())
    val state: StateFlow<SessionSummaryState> = _state.asStateFlow()

    fun loadSummary(sessionId: String) {
        viewModelScope.launch {
            val summary = getSummaryUseCase(sessionId)
            val bonusEnergy = summary.totalCount / 5
            _state.update {
                it.copy(
                    summary = summary,
                    bonusEnergy = bonusEnergy,
                    isLoading = false
                )
            }
        }
    }
}

data class SessionSummaryState(
    val summary: NotificationSummary? = null,
    val bonusEnergy: Int = 0,
    val isLoading: Boolean = true
)
```

## Dependencies

- [ ] Task 004 - Repository and UseCases must exist
- [ ] Material Design 3 (already in project)

## Effort Estimate

- Size: M
- Hours: 4
- Parallel: true (can work alongside 006)

## Definition of Done

- [ ] Dialog displays correctly with summary data
- [ ] Top 5 apps shown with counts
- [ ] Energy bonus calculated and displayed
- [ ] Navigation to history works
- [ ] Dialog dismisses properly
- [ ] Animations are smooth
- [ ] Preview composables for testing
